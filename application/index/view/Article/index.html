{extend name="base" /}

{block name="title"}个人博客首页{/block}

{block name="main"}

<div class="main">
    <div class="container">
        <div class="row" >
            <div class="content col-lg-9">
                <div class="sheet post">
                    <header>
                    <h2>{$article.title}</h2>
                    <p class="post-meta">
                        <span class="octicon octicon-clock"></span> {$article.addtime|date="Y-m-d",###}
                    </p>
                    <p class="post-tag">
                        <span>
                            <a href="{:url('index/index/categoryList',['cid'=>$category.cid])}">
                            <span class="octicon octicon-list-unordered"></span>&nbsp;{$category.cname}
                            </a>
                        </span>
                        <span>
                            {volist name='tags' id='tag'}
                            <a class="word-keep" href="{:url('index/index/tag',['tid'=>$tag.tid])}">
                            <span class="octicon octicon-tag"></span>&nbsp;{$tag.tname}
                            {/volist}
                            </a>                 
                        </span>
                        <span class="word-keep pull-right">
                            <span class="glyphicon glyphicon-user"></span>&nbsp;{$article.click}
                        </span>
                    </p>
                    </header>
            
                    <hr class="boundary">
            
                    <article>
                        {$article.content}    
                    </article>
            
                    <hr class="boundary">    
                </div>

                <div class="pad-min"></div>

                <div id="post-comment" class="sheet post" >
                    <div id="disqus_thread">评论 

<script type="text/javascript">

function comment(obj){
    
    var content = $(obj).parent().find('textarea').val();
    var tarPid = $(obj).attr('pid');
    
    url = "{:url('index/index/comment')}";
    //console.log(url);
    
    //点击评论，先删除下面的回复框
    $('#reply-textarea').remove();

    $.ajax({  
                type:"post",  
                url:"{:url('index/index/comment')}",  
                data:{ "aid":"{$article.aid}","content":content,"pid":tarPid },//这里data传递过去的是序列化以后的字符串  
                success:function(mes){
                    //直接评论，就是评论本文，pid为0，最顶级  
                    var response = JSON.parse(mes);     //回应对象

                    if(response.cmtid == 0){
                        alert('评论错误，请正确评论');
                    }else{
                        //判断是回复文章本身，还是回复用户reply
                        if(tarPid == 0){
                            //回复文章本身
                            $('#usercomment').append("<div id='comment-"+response.cmtid+"\' class='row b-user b-parent'><div class='col-xs-2 col-sm-1 col-md-1 col-lg-1 b-pic-col'><span class='glyphicon glyphicon-user'></span></div><div class='col-xs-10 col-sm-11 col-md-11 col-lg-11 b-content-col b-cc-first' id='reply-"+response.cmtid+"\'><p class='b-content'><span class='b-user-name'></span>"+response.ouip+"回复："+response.content+"</p><p class='b-date'>"+response.date+" <a href='javascript:;' aid=\'"+response.aid+"\' pid=\'"+response.cmtid+"\' username=\'"+response.ouid+"\' onclick='reply(this)'>回复</a></p><div class='b-clear-float'></div></div></div>");
                            $('#usercomment').append("<div class='row'><div class='col-xs-12 col-sm-12 col-md-12 col-lg-12'><div class='b-border'></div></div></div>");             
                        
                        }else{
                            //回复用户
                            console.log('#reply-'+tarPid);
                            console.log($('#reply-'+tarPid));
                            $('#reply-'+tarPid).append("<div id='comment-"+tarPid+"\' class='row b-user b-parent'><div class='col-xs-2 col-sm-1 col-md-1 col-lg-1 b-pic-col'><span class='glyphicon glyphicon-user'></span></div><div class='col-xs-10 col-sm-11 col-md-11 col-lg-11 b-content-col b-cc-first' id='reply-"+tarPid+"\'><p class='b-content'><span class='b-user-name'></span>"+response.ouip+"回复："+response.content+"</p><p class='b-date'>"+response.date+" <a href='javascript:;' aid=\'"+response.aid+"\' pid=\'"+tarPid+"\' username=\'"+response.ouid+"\' onclick='reply(this)'>回复</a></p><div class='b-clear-float'></div></div></div>");
                            $('#reply-'+tarPid).append("<div class='row'><div class='col-xs-12 col-sm-12 col-md-12 col-lg-12'><div class='b-border'></div></div></div>");                
                            
                        }
                    }
                    
                    
                    
                }  
            });
    
}

//对别人的评论做回复
function reply(obj){
    
    var aid = $(obj).attr('aid');
    var pid = $(obj).attr('pid');
    var username = $(obj).attr('username');

    //点击回复后，先增加回复框
    //先删除原来的回复框，再添加新的
    $('#reply-textarea').remove();
    $(obj).parent().parent().append("<div class='b-box-textarea' id='reply-textarea'><textarea class='form-control' rows='3'></textarea><input type='button' value='评 论' aid=\'"+aid+"\' pid=\'"+pid+"\' onclick='comment(this)'></div>");


}

</script>

                        <div class="row b-comment">

                            
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 b-comment-box">
                                <span class="glyphicon glyphicon-user"></span>
                                <div class="b-box-textarea " >
                                
                                    <textarea class="form-control" rows="3"></textarea>
                                    <input type="button" value="评 论" aid="125" pid="0" onclick="comment(this)">              

                                </div>
                                
                                <div class="b-clear-float"></div>
                            </div>
                                    
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 b-comment-title">
                                <ul class="row list-unstyled">
                                    <li class="col-xs-6 col-sm-6 col-md-6 col-lg-6">最新评论</li>
                                    <li class="col-xs-6 col-sm-6 col-md-6 col-lg-6 text-right ">总共<span>{$totalComment}</span>条评论</li>
                                </ul>
                            </div>

                            <div class="row">
                                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                    <div class="b-border" style="border:1px solid blue"></div>
                                </div>
                            </div>
                            <!--读者评论显示-->
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 b-user-comment" id="usercomment">

                                {volist name='parentComment' id='parCom'}
                                <div id="comment-{$parCom.cmtid}" class="row b-user b-parent">
                                    <div class="col-xs-2 col-sm-1 col-md-1 col-lg-1 b-pic-col">
                                            <span class="glyphicon glyphicon-user"></span>
                                    </div>
                                    <div class="col-xs-10 col-sm-11 col-md-11 col-lg-11 b-content-col b-cc-first" id="reply-{$parCom.cmtid}" >
                                        <p class="b-content">
                                            <span class="b-user-name"></span>{$parCom.ouip}：{$parCom.content}
                                        </p>
                                        <p class="b-date">
                                            {$parCom.date|date='Y-m-d H:i:s',###} <a href="javascript:;" aid="{$parCom.aid}" pid="{$parCom.cmtid}" username="{$parCom.ouip}" onclick="reply(this)">回复</a>
                                        </p>
                                        
                                        <div class="b-clear-float"></div>

                                        <!--对评论内容的回复-->
                                        {volist name='childComment' id='chiCom'}
                                        {if condition="$chiCom.pid == $parCom.cmtid"}

                                        <div id="comment-{$parCom.cmtid}" class="row b-user b-parent">
                                            <div class="col-xs-2 col-sm-1 col-md-1 col-lg-1 b-pic-col">
                                                    <span class="glyphicon glyphicon-user"></span>
                                            </div>
                                            <div class="col-xs-10 col-sm-11 col-md-11 col-lg-11 b-content-col b-cc-first" id="reply-{$parCom.cmtid}" >
                                                <p class="b-content">
                                                    <span class="b-user-name"></span>{$chiCom.ouip}：{$chiCom.content}
                                                </p>
                                                <p class="b-date">
                                                    {$chiCom.date|date='Y-m-d H:i:s',###} <a href="javascript:;" aid="{$chiCom.aid}" pid="{$parCom.cmtid}" username="{$chiCom.ouip}" onclick="reply(this)">回复</a>
                                                </p>
                                                
                                                <div class="b-clear-float"></div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="b-border"></div>
                                            </div>
                                        </div>
                                        {/if}
                                        {/volist}
                                        <!--对评论内容的回复截止-->
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="b-border"></div>
                                    </div>
                                </div>
                                {/volist}
          
                                            
                            </div>
                        </div>

                        <!--评论结束-->
                    </div>
                </div>

            </div>  
        </div>
    </div>

    <div class="page-scrollTop" data-toggle="tooltip" data-placement="top" title="Top">
    <!--返回top-->
        <a href="javascript:void(0);">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
</div>

{/block}